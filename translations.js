// Language Translations
const translations = {
    en: {
        // Header
        'title': 'Family Lineage',
        'subtitle': 'Family of Munawwar Chand Sahib',
        'nav-tree': 'View Family Tree',
        'nav-form': 'Genealogy Form',

        // Search & Filters
        'search-placeholder': 'Search family members by name...',
        'filter-all-generations': 'All Generations',
        'filter-all-professions': 'All Professions',
        'clear-filters': 'Clear Filters',

        // Statistics
        'stats-title': 'Family Statistics',
        'stat-total-members': 'Total Members',
        'stat-generations': 'Generations',
        'stat-families': 'Family Branches',
        'stat-timeline': 'Timeline Span',

        // Views
        'view-tree': 'Tree View',
        'view-timeline': 'Timeline View',
        'view-stats': 'Statistics',

        // Sections
        'section-family-tree': 'Family Tree',
        'section-family-details': 'Family Details',
        'section-great-grandfather': 'Great-Grandfather',
        'section-role': 'Role:',
        'section-description': 'Description:',
        'section-son': 'Son:',
        'section-children': 'Children:',
        'section-children-sons': 'Children (Sons):',

        // Footer
        'footer-note': 'This genealogy has been accurately corrected to reflect that Late Muhammad Abdul Ghani Sahib was the second son of Munawwar Chand Sahib. Further verified information may be added to complete the historical record.',

        // Tree Status
        'tree-loaded': 'Tree data loaded from form',
        'tree-default': 'Using default family tree data',
        'tree-updated': 'Family tree updated with latest data!',
        'last-updated': 'Last updated:',
        'fill-form': 'Fill Form',

        // Timeline
        'timeline-title': 'Family Timeline',
        'timeline-date-unknown': 'Date Unknown',
        'timeline-no-data': 'No timeline data available. Fill out the form with dates to see timeline.',

        // Notifications
        'no-results': 'No family members found matching your search.',
        'filters-updated': 'Filters updated with latest form data!',

        // Form Management
        'form-management': 'Form Management',
        'form-number': 'Form #:',
        'form-version': 'Version:',
        'form-status': 'Status:',
        'status-draft': 'Draft',
        'status-edit': 'Edit Mode',
        'new-form': '+ New Form',
        'load-form': 'Load Form',
        'form-history': 'History',
        'backup-all': 'Backup All Forms',
        'import-forms': 'Import Forms',

        // Common
        'great-grandfather': 'Great-Grandfather',
        'description': 'Description:',
        'son': 'Son:',
        'children': 'Children:',
        'children-sons': 'Children (Sons):',
        'wife': 'Wife:',
        'residence': 'Residence:',
        'role': 'Role:',
    },
    ur: {
        // Header
        'title': 'خاندانی نسب نامہ',
        'subtitle': 'منور چند صاحب کا خاندان',
        'nav-tree': 'خاندانی درخت دیکھیں',
        'nav-form': 'نسب نامہ فارم',

        // Search & Filters
        'search-placeholder': 'نام سے خاندانی اراکین تلاش کریں...',
        'filter-all-generations': 'تمام نسلیں',
        'filter-all-professions': 'تمام پیشے',
        'clear-filters': 'فلٹر صاف کریں',

        // Statistics
        'stats-title': 'خاندانی اعداد و شمار',
        'stat-total-members': 'کل اراکین',
        'stat-generations': 'نسلیں',
        'stat-families': 'خاندانی شاخیں',
        'stat-timeline': 'وقت کی حد',

        // Views
        'view-tree': 'درخت کا منظر',
        'view-timeline': 'وقت کی لائن',
        'view-stats': 'اعداد و شمار',

        // Sections
        'section-family-tree': 'خاندانی درخت',
        'section-family-details': 'خاندانی تفصیلات',
        'section-great-grandfather': 'پردادا',
        'section-role': 'کردار:',
        'section-description': 'تفصیل:',
        'section-son': 'بیٹا:',
        'section-children': 'بچے:',
        'section-children-sons': 'بچے (بیٹے):',

        // Footer
        'footer-note': 'یہ نسب نامہ درست طریقے سے تیار کیا گیا ہے تاکہ یہ ظاہر ہو کہ مرحوم محمد عبدالغنی صاحب منور چند صاحب کے دوسرے بیٹے تھے۔ مزید تصدیق شدہ معلومات تاریخی ریکارڈ کو مکمل کرنے کے لیے شامل کی جا سکتی ہے۔',

        // Tree Status
        'tree-loaded': 'درخت کا ڈیٹا فارم سے لوڈ ہوا',
        'tree-default': 'پہلے سے طے شدہ خاندانی درخت کا ڈیٹا استعمال کر رہے ہیں',
        'tree-updated': 'خاندانی درخت تازہ ترین ڈیٹا کے ساتھ اپ ڈیٹ ہو گیا!',
        'last-updated': 'آخری اپ ڈیٹ:',
        'fill-form': 'فارم بھریں',

        // Timeline
        'timeline-title': 'خاندانی وقت کی لائن',
        'timeline-date-unknown': 'تاریخ نامعلوم',
        'timeline-no-data': 'وقت کی لائن کا ڈیٹا دستیاب نہیں۔ وقت کی لائن دیکھنے کے لیے فارم میں تاریخوں کے ساتھ بھریں۔',

        // Notifications
        'no-results': 'آپ کی تلاش سے میل کھانے والا کوئی خاندانی رکن نہیں ملا۔',
        'filters-updated': 'فلٹرز تازہ ترین فارم ڈیٹا کے ساتھ اپ ڈیٹ ہو گئے!',

        // Form Management
        'form-management': 'فارم انتظام',
        'form-number': 'فارم #:',
        'form-version': 'ورژن:',
        'form-status': 'حالت:',
        'status-draft': 'مسودہ',
        'status-edit': 'ترمیم موڈ',
        'new-form': '+ نیا فارم',
        'load-form': 'فارم لوڈ کریں',
        'form-history': 'تاریخ',
        'backup-all': 'تمام فارمز کا بیک اپ',
        'import-forms': 'فارمز درآمد کریں',

        // Common
        'great-grandfather': 'پردادا',
        'description': 'تفصیل:',
        'son': 'بیٹا:',
        'children': 'بچے:',
        'children-sons': 'بچے (بیٹے):',
        'wife': 'بیوی:',
        'residence': 'رہائش:',
        'role': 'کردار:',
    }
};

// Current language
let currentLanguage = localStorage.getItem('preferred-language') || 'en';

// Get translation
function t(key) {
    return translations[currentLanguage][key] || translations['en'][key] || key;
}

// Switch language
function switchLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('preferred-language', lang);
    updatePageLanguage();
}

// Update all translatable elements on the page
function updatePageLanguage() {
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = t(key);

        if (!translation || translation === key) return;

        if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'search')) {
            element.placeholder = translation;
        } else if (element.tagName === 'OPTION') {
            element.textContent = translation;
        } else if (element.tagName === 'BUTTON') {
            element.textContent = translation;
        } else {
            const hasChildren = element.children.length > 0;
            if (!hasChildren) {
                element.textContent = translation;
            } else {
                const textNodes = Array.from(element.childNodes).filter(n => n.nodeType === 3);
                if (textNodes.length > 0 && element.childNodes.length === textNodes.length) {
                    element.textContent = translation;
                }
            }
        }
    });

    document.documentElement.lang = currentLanguage;
    document.documentElement.setAttribute('dir', currentLanguage === 'ur' ? 'rtl' : 'ltr');

    if (currentLanguage === 'ur') {
        document.body.style.direction = 'rtl';
        document.body.style.textAlign = 'right';
        document.body.classList.add('urdu-mode');
        document.body.classList.remove('english-mode');
    } else {
        document.body.style.direction = 'ltr';
        document.body.style.textAlign = 'left';
        document.body.classList.add('english-mode');
        document.body.classList.remove('urdu-mode');
    }

    // Update language switcher button
    const langBtn = document.getElementById('language-switcher');
    if (langBtn) {
        langBtn.textContent = currentLanguage === 'en' ? 'اردو' : 'English';
        langBtn.setAttribute('aria-label',
            currentLanguage === 'en' ? 'Switch language to Urdu' : 'Switch language to English'
        );
    }

    // Update timeline title if needed
    const timelineTitle = document.querySelector('#timeline-container .section-title');
    if (timelineTitle && !timelineTitle.hasAttribute('data-i18n')) {
        timelineTitle.setAttribute('data-i18n', 'timeline-title');
        timelineTitle.textContent = t('timeline-title');
    }
}

// Apply language once DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updatePageLanguage);
} else {
    updatePageLanguage();
}
